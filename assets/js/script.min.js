document.addEventListener("DOMContentLoaded",t=>{if(null!==document.querySelector("#test-ui"))null!==document.querySelector(".test-form-new")&&document.querySelectorAll(".test-form-new").forEach(t=>{t.addEventListener("submit",t=>{let e=t.target.getAttribute("action")+t.target.querySelector('[name="board"]').value;t.submitter.setAttribute("formaction",e)})}),null!==document.querySelector(".test-form")&&document.querySelectorAll(".test-form").forEach(t=>{t.addEventListener("submit",t=>{t.preventDefault();let e=t.target.getAttribute("action")+t.target.querySelector('[name="board"]').value;fetch(e,{method:t.target.getAttribute("method").toUpperCase(),body:new URLSearchParams(new FormData(t.target))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(t=>{try{t=JSON.parse(t)}catch(t){}alert(void 0!==t.error?t.error:t.result)}).catch(t=>{console.log(t)})})});else if(null!==document.querySelector("#board-title")){let t=window.location.pathname.match(/(\/.*)*\/b\/([A-Za-z0-9]+)\/?$/);var e=t[1]+"/",r=t[2],a=`${e}api/threads/${r}?limit=0`;document.querySelector("#board-title").innerHTML=`Welcome to <a href="${e}">/</a><a href="${e}b/${r}">b/${r}</a>`,fetch(a,{method:"GET"}).then(t=>{if(t.ok)return t.json();throw"Error"}).then(t=>{let a="";t.forEach(t=>{a+=`\n\t\t\t\t<div class="card thread mb-2">\n\t\t\t\t\t<h5 class="card-header">${t.text}</h5>\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<div class="replies">\n\t\t\t\t`;let n=t.replycount-3;n<1&&(n=0),a+=`<p class="card-text">${t.replycount} replies total (${n} hidden) - <a href="${e}b/${r}/${t.id}">See the full thread here</a>.</p>`,t.replies.forEach(n=>{a+=`\n\t\t\t\t\t\t\t<div class="card reply mb-2">\n\t\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t\t<p class="card-text">${n.text}</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${n.created_on}</span></p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="id m-0"><span class="fw-semibold">Reply ID:</span> <span>${n.id}</span></p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t\t\t\t\t<form class="board-form me-4" action="${e}api/replies/${r}" method="put">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${n.id}">\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report reply">\n\t\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t\t<form class="board-form d-flex" action="${e}api/replies/${r}" method="delete">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${n.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete reply">\n\t\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t`}),a+=`\n\t\t\t\t\t\t\t<div class="mt-3">\n\t\t\t\t\t\t\t\t<form class="board-form text-center" action="${e}api/replies/${r}" method="post">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t<textarea class="form-control mb-2" rows="5" cols="80" name="text" placeholder="Quick reply..." required></textarea>\n\t\t\t\t\t\t\t\t\t<input class="form-control mb-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t<input class="btn btn-primary" type="submit" value="Submit">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${t.created_on}</span></p>\n\t\t\t\t\t\t\t\t<p class="m-0"><span class="fw-semibold">Thread ID:</span> <span>${t.id}</span></p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t\t<form class="board-form me-4" action="${e}api/threads/${r}" method="put">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report thread">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t<form class="board-form d-flex" action="${e}api/threads/${r}" method="delete">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}" required>\n\t\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete thread">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t`}),document.querySelector("#board-display").innerHTML=a}).catch(t=>{console.log(t)}),document.querySelector("#new-thread").addEventListener("submit",t=>{t.preventDefault();let e=t.target.getAttribute("action");fetch(e,{method:t.target.getAttribute("method").toUpperCase(),body:new URLSearchParams(new FormData(t.target))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(e=>{try{e=JSON.parse(e)}catch(t){}void 0!==e.error?alert(e.error):(t.target.reset(),window.location.reload())}).catch(t=>{console.log(t)})})}else if(null!==document.querySelector("#thread-title")){let t=window.location.pathname.match(/(\/.*)*\/b\/([A-Za-z0-9]+)\/([A-Za-z0-9]+)\/?$/);e=t[1]+"/",r=t[2];var n=t[3];a=`${e}api/replies/${r}`;document.querySelector("#thread-title").innerHTML=`Welcome to <a href="${e}">/</a><a href="${e}b/${r}">b/${r}</a><a href="${e}b/${r}/${n}">/${n}</a>`,fetch(a+"?"+new URLSearchParams({thread_id:n,limit:0}).toString(),{method:"GET"}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(t=>{try{n=JSON.parse(t)}catch(t){return void(window.location.href=`${e}b/${r}`)}if(!Object.keys(n).length)return void(window.location.href=`${e}b/${r}`);let a="";a+=`\n\t\t\t<div class="card thread mb-2">\n\t\t\t\t<h5 class="card-header">${n.text}</h5>\n\t\t\t\t<div class="card-body">\n\t\t\t\t\t<div class="replies">\n\t\t\t`,n.replies.forEach(t=>{a+=`\n\t\t\t\t\t\t<div class="card reply mb-2">\n\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t<p class="card-text">${t.text}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${t.created_on}</span></p>\n\t\t\t\t\t\t\t\t\t\t<p class="id m-0"><span class="fw-semibold">Reply ID:</span> <span>${t.id}</span></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t\t\t\t<form class="board-form me-4" action="${e}api/replies/${r}" method="put">\n\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${n.id}">\n\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report reply">\n\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t<form class="board-form d-flex" action="${e}api/replies/${r}" method="delete">\n\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${n.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${t.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete reply">\n\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t`}),a+=`\n\t\t\t\t\t\t<div class="mt-3">\n\t\t\t\t\t\t\t<form class="board-form text-center" action="${e}api/replies/${r}" method="post">\n\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${n.id}">\n\t\t\t\t\t\t\t\t<textarea class="form-control mb-2" rows="5" cols="80" name="text" placeholder="Quick reply..." required></textarea>\n\t\t\t\t\t\t\t\t<input class="form-control mb-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t<input class="btn btn-primary" type="submit" value="Submit">\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${n.created_on}</span></p>\n\t\t\t\t\t\t\t<p class="m-0"><span class="fw-semibold">Thread ID:</span> <span>${n.id}</span></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t<form class="board-form me-4" action="${e}api/threads/${r}" method="put">\n\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${n.id}">\n\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report thread">\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t<form class="board-form d-flex" action="${e}api/threads/${r}" method="delete">\n\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${n.id}" required>\n\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete thread">\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t`,document.querySelector("#board-display").innerHTML=a}).catch(t=>{console.log(t)})}null!==document.querySelector("#board-display")&&document.querySelector("#board-display").addEventListener("submit",t=>{if(t.target.closest(".board-form")){t.preventDefault();let a=t.target.closest(".board-form").getAttribute("action"),n=t.target.closest(".board-form").getAttribute("method").toUpperCase();fetch(a,{method:n,body:new URLSearchParams(new FormData(t.target.closest(".board-form")))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(d=>{try{d=JSON.parse(d)}catch(t){}if(a.toLowerCase().includes("api/replies")&&"POST"==n&&void 0!==d.id){let t=d.id;window.location.href=`${e}b/${r}/${t}`}else t.submitter.value.toLowerCase().includes("delete")&&"DELETE"==n&&void 0!==d.result&&"Successfully deleted"==d.result?(alert(void 0!==d.error?d.error:d.result),window.location.reload()):alert(void 0!==d.error?d.error:d.result)}).catch(t=>{console.log(t)})}})});