document.addEventListener("DOMContentLoaded",t=>{function e(){fetch(n,{method:"GET"}).then(t=>{if(t.ok)return t.json();throw"Error"}).then(t=>{if(!Object.keys(t).length)return alert("Thread does not exist"),void(window.location.href=`${r}b/${a}`);let e=n.toLowerCase().includes("api/replies");e&&(t=[t]);let o="";t.forEach(t=>{if(o+=`\n\t\t\t\t<div class="card thread mb-2">\n\t\t\t\t\t<h5 class="card-header">${t.text}</h5>\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<div class="replies">\n\t\t\t\t`,!e){let e=t.replycount-3;e<1&&(e=0),o+=`<p class="card-text">${t.replycount} replies total (${e} hidden) - <a href="${r}b/${a}/${t.id}">See the full thread here</a>.</p>`}t.replies.forEach(e=>{o+=`\n\t\t\t\t\t\t\t<div class="card reply mb-2">\n\t\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t\t<p class="card-text">${e.text}</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${e.created_on}</span></p>\n\t\t\t\t\t\t\t\t\t\t\t<p class="id m-0"><span class="fw-semibold">Reply ID:</span> <span>${e.id}</span></p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t\t\t\t\t<form class="board-form me-4" action="${r}api/replies/${a}" method="put">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${e.id}">\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report reply">\n\t\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t\t<form class="board-form d-flex" action="${r}api/replies/${a}" method="delete">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="reply_id" value="${e.id}" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete reply">\n\t\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t`}),o+=`\n\t\t\t\t\t\t\t<div class="mt-3">\n\t\t\t\t\t\t\t\t<form class="board-form text-center" action="${r}api/replies/${a}" method="post">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t<textarea class="form-control mb-2" rows="5" cols="80" name="text" placeholder="Quick reply..." required></textarea>\n\t\t\t\t\t\t\t\t\t<input class="form-control mb-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t<input class="btn btn-primary" type="submit" value="Submit">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="card-footer text-muted">\n\t\t\t\t\t\t<div class="row align-items-center">\n\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t<p class="mb-2"><span class="fw-semibold">Created on:</span> <span>${t.created_on}</span></p>\n\t\t\t\t\t\t\t\t<p class="m-0"><span class="fw-semibold">Thread ID:</span> <span>${t.id}</span></p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col d-flex justify-content-end">\n\t\t\t\t\t\t\t\t<form class="board-form me-4" action="${r}api/threads/${a}" method="put">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}">\n\t\t\t\t\t\t\t\t\t<input class="btn btn-warning" type="submit" value="Report thread">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t<form class="board-form d-flex" action="${r}api/threads/${a}" method="delete">\n\t\t\t\t\t\t\t\t\t<input type="hidden" name="thread_id" value="${t.id}" required>\n\t\t\t\t\t\t\t\t\t<input class="form-control me-2" type="text" name="delete_password" placeholder="Password to delete" autocomplete="off" required>\n\t\t\t\t\t\t\t\t\t<input class="btn btn-danger" type="submit" value="Delete thread">\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t`}),document.querySelector("#board-display").innerHTML=o}).catch(t=>{console.log(t)})}if(null!==document.querySelector("#test-ui"))null!==document.querySelector(".test-form-new")&&document.querySelectorAll(".test-form-new").forEach(t=>{t.addEventListener("submit",t=>{let e=t.target.getAttribute("action")+t.target.querySelector('[name="board"]').value;t.submitter.setAttribute("formaction",e)})}),null!==document.querySelector(".test-form")&&document.querySelectorAll(".test-form").forEach(t=>{t.addEventListener("submit",t=>{t.preventDefault();let e=t.target.getAttribute("action")+t.target.querySelector('[name="board"]').value;fetch(e,{method:t.target.getAttribute("method").toUpperCase(),body:new URLSearchParams(new FormData(t.target))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(t=>{try{t=JSON.parse(t)}catch(t){}alert(void 0!==t.error?t.error:t.result)}).catch(t=>{console.log(t)})})});else if(null!==document.querySelector("#board-title")){let t=window.location.pathname.match(/(\/.*)*\/b\/([A-Za-z0-9]+)\/?$/);var r=t[1]+"/",a=t[2],n=`${r}api/threads/${a}?limit=0`;document.querySelector("#board-title").innerHTML=`Welcome to <a href="${r}">/</a><a href="${r}b/${a}">b/${a}</a>`,e(),document.querySelector("#new-thread").addEventListener("submit",t=>{t.preventDefault();let r=t.target.getAttribute("action");fetch(r,{method:t.target.getAttribute("method").toUpperCase(),body:new URLSearchParams(new FormData(t.target))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(r=>{try{r=JSON.parse(r)}catch(t){}void 0!==r.error?alert(r.error):(t.target.reset(),e())}).catch(t=>{console.log(t)})})}else if(null!==document.querySelector("#thread-title")){let t=window.location.pathname.match(/(\/.*)*\/b\/([A-Za-z0-9]+)\/([A-Za-z0-9]+)\/?$/);r=t[1]+"/",a=t[2];var o=t[3];n=`${r}api/replies/${a}?`+new URLSearchParams({thread_id:o,limit:0}).toString();document.querySelector("#thread-title").innerHTML=`Welcome to <a href="${r}">/</a><a href="${r}b/${a}">b/${a}</a><a href="${r}b/${a}/${o}">/${o}</a>`,e()}null!==document.querySelector("#board-display")&&document.querySelector("#board-display").addEventListener("submit",t=>{if(t.target.closest(".board-form")){t.preventDefault();let r=t.target.closest(".board-form").getAttribute("action"),a=t.target.closest(".board-form").getAttribute("method").toUpperCase();fetch(r,{method:a,body:new URLSearchParams(new FormData(t.target.closest(".board-form")))}).then(t=>{if(t.ok)return t.text();throw"Error"}).then(n=>{try{n=JSON.parse(n)}catch(t){}r.toLowerCase().includes("api/replies")&&"POST"==a?(e(),window.scrollTo({top:0,left:0,behavior:"smooth"})):t.submitter.value.toLowerCase().includes("delete")&&"DELETE"==a&&void 0!==n.result&&"Successfully deleted"==n.result?(alert(void 0!==n.error?n.error:n.result),e()):alert(void 0!==n.error?n.error:n.result)}).catch(t=>{console.log(t)})}})});